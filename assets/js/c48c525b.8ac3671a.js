"use strict";(self.webpackChunkcashew_da_docs=self.webpackChunkcashew_da_docs||[]).push([[283],{6697:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>o});var n=a(5893),t=a(1151);const i={},l=void 0,r={id:"Models/Loss_Functions",title:"Loss_Functions",description:"Brief description of the submodule",source:"@site/docs/Models/Loss_Functions.md",sourceDirName:"Models",slug:"/Models/Loss_Functions",permalink:"/CashewDA-docs/docs/Models/Loss_Functions",draft:!1,unlisted:!1,editUrl:"https://github.com/${organizationName}/${projectName}/tree/main/docs/Models/Loss_Functions.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"BuildingBlocks",permalink:"/CashewDA-docs/docs/Models/BuildingBlocks"},next:{title:"U_Net",permalink:"/CashewDA-docs/docs/Models/U_Net"}},c={},o=[{value:"Brief description of the submodule",id:"brief-description-of-the-submodule",level:2},{value:"FocalLoss",id:"focalloss",level:2},{value:"Attributes",id:"attributes",level:3},{value:"Methods",id:"methods",level:3},{value:"Source code",id:"source-code",level:3}];function m(e){const s={a:"a",annotation:"annotation",code:"code",h2:"h2",h3:"h3",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",mtext:"mtext",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"brief-description-of-the-submodule",children:"Brief description of the submodule"}),"\n",(0,n.jsxs)(s.p,{children:["In this submodule all of the classes used for the definition of the loss functions used during training of the networks described in ",(0,n.jsx)(s.a,{href:"./U_Net#networks-implemented",children:"Networks implemented"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"focalloss",children:"FocalLoss"}),"\n",(0,n.jsxs)(s.p,{children:["Class used to calculate the ",(0,n.jsx)(s.a,{href:"https://paperswithcode.com/method/focal-loss",children:"focal loss"})," used for the backward propagation of the segmentation heads of the ",(0,n.jsx)(s.a,{href:"./U_Net#networks-implemented",children:"Networks implemented"}),"."]}),"\n",(0,n.jsx)(s.p,{children:"The Focal loss can be calculated as:"}),"\n",(0,n.jsx)(s.span,{className:"katex-display",children:(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{children:"F"}),(0,n.jsx)(s.mi,{children:"o"}),(0,n.jsx)(s.mi,{children:"c"}),(0,n.jsx)(s.mi,{children:"a"}),(0,n.jsx)(s.mi,{children:"l"}),(0,n.jsx)(s.mtext,{children:"\xa0"}),(0,n.jsx)(s.mi,{children:"l"}),(0,n.jsx)(s.mi,{children:"o"}),(0,n.jsx)(s.mi,{children:"s"}),(0,n.jsx)(s.mi,{children:"s"}),(0,n.jsx)(s.mo,{children:"="}),(0,n.jsx)(s.mo,{children:"\u2212"}),(0,n.jsx)(s.mi,{children:"\u03b1"}),(0,n.jsx)(s.mo,{children:"\u22c5"}),(0,n.jsx)(s.mo,{stretchy:"false",children:"("}),(0,n.jsx)(s.mn,{children:"1"}),(0,n.jsx)(s.mo,{children:"\u2212"}),(0,n.jsx)(s.mi,{children:"p"}),(0,n.jsxs)(s.msup,{children:[(0,n.jsx)(s.mo,{stretchy:"false",children:")"}),(0,n.jsx)(s.mi,{children:"\u03b3"})]}),(0,n.jsx)(s.mo,{children:"\u22c5"}),(0,n.jsx)(s.mi,{children:"log"}),(0,n.jsx)(s.mo,{children:"\u2061"}),(0,n.jsx)(s.mo,{stretchy:"false",children:"("}),(0,n.jsx)(s.mi,{children:"p"}),(0,n.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"Focal\\ loss = -\\alpha \\cdot (1-p)^\\gamma \\cdot \\log(p)"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"oc"}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"a"}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,n.jsx)(s.span,{className:"mspace",children:"\xa0"}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"oss"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(s.span,{className:"mrel",children:"="}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6667em",verticalAlign:"-0.0833em"}}),(0,n.jsx)(s.span,{className:"mord",children:"\u2212"}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"\u22c5"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.jsx)(s.span,{className:"mopen",children:"("}),(0,n.jsx)(s.span,{className:"mord",children:"1"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,n.jsxs)(s.span,{className:"mclose",children:[(0,n.jsx)(s.span,{className:"mclose",children:")"}),(0,n.jsx)(s.span,{className:"msupsub",children:(0,n.jsx)(s.span,{className:"vlist-t",children:(0,n.jsx)(s.span,{className:"vlist-r",children:(0,n.jsx)(s.span,{className:"vlist",style:{height:"0.7144em"},children:(0,n.jsxs)(s.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05556em"},children:"\u03b3"})})]})})})})})]}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"\u22c5"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.jsxs)(s.span,{className:"mop",children:["lo",(0,n.jsx)(s.span,{style:{marginRight:"0.01389em"},children:"g"})]}),(0,n.jsx)(s.span,{className:"mopen",children:"("}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(s.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,n.jsxs)(s.p,{children:["Big shout out to ",(0,n.jsx)(s.a,{href:"https://gist.github.com/f1recracker/0f564fd48f15a58f4b92b3eb3879149b",children:"f1recracker"}),", whose implementation was adapted to create the focal loss function."]}),"\n",(0,n.jsx)(s.h3,{id:"attributes",children:"Attributes"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"gamma:"})," (float) Hyper-parameter to be tuned which determines how much importance is given to misclassified examples. The higher the value, the higher the importance."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"alpha:"})," (float) Hyper-parameter to be tuned which serves as a weighing factorfor the different classes."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"size_average:"})," (boolean) Boolean to indicate if the funcion returns the mean value or the sum. Default is True."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"ignore_index:"})," (int) Index of the class that will be ignored."]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"methods",children:"Methods"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"forward:"})," Function indicating the forward stepss to calculate the Focal Loss function for an predicted input and a target tensor."]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"source-code",children:"Source code"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"class FocalLoss(nn.Module):\n    def __init__(self, gamma=0, alpha=None, size_average=True, ignore_index = None):\n        super(FocalLoss, self).__init__()\n        self.gamma = gamma\n        self.alpha = alpha\n        if isinstance(alpha,(float,int)): self.alpha = torch.Tensor([alpha,1-alpha])\n        if isinstance(alpha,list): self.alpha = torch.Tensor(alpha)\n        self.size_average = size_average\n        self.ignore_index = ignore_index\n\n    def forward(self, input, target):\n\n        if input.dim() > 2:\n            input = input.view(input.size(0),input.size(1),-1)  # N,C,H,W => N,C,H*W\n            input = input.transpose(1,2)    # N,C,H*W => N,H*W,C\n            input = input.contiguous().view(-1,input.size(2))   # N,H*W,C => N*H*W,C\n        \n        target = target.view(-1,1)\n        \n        if self.ignore_index != None:\n            # Filter predictions with ignore label from loss computation\n            mask = target != self.ignore_index\n\n            target = target[mask[:,0], :]\n            input = input[mask[:,0], :]\n        \n        logpt = F.log_softmax(input, dim=-1)\n        logpt = logpt.gather(1, target)\n        logpt = logpt.view(-1)\n        \n        pt = Variable(logpt.data.exp())\n\n        if self.alpha is not None:\n            if self.alpha.type()!=input.data.type():\n                self.alpha = self.alpha.type_as(input.data)\n            at = self.alpha.gather(0,target.data.view(-1))\n            logpt = logpt * Variable(at)\n\n        loss = -1 * (1-pt)**self.gamma * logpt\n        if self.size_average: return loss.mean()\n        else: return loss.sum()\n"})})]})}function h(e={}){const{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(m,{...e})}):m(e)}},1151:(e,s,a)=>{a.d(s,{Z:()=>r,a:()=>l});var n=a(7294);const t={},i=n.createContext(t);function l(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);